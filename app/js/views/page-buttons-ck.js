define(["text!templates/page-buttons.html"],function(e){var t=Backbone.View.extend({template:_.template(e),isVisible:!1,events:{"click .preview-buttons .edit-button":function(){this.trigger("randomStyle")},"click .preview-buttons .next-button":function(){this.trigger("selectNextNote")},"click .preview-buttons .prev-button":function(){this.trigger("selectPreviousNote")},"click .edit-buttons .ok-button":function(){this.trigger("saveNote")}},initialize:function(e){this.app=e.app;this.app.on("noteSelected",this.affixButtons,this);this.on("click",".randomise-button",function(){this.app.trigger("randomStyle");this.affixButtons()})},affixButtons:function(e){var t=[],n=this.buttonsAreVisible();$(".page-buttons").each(function(){$(this).parent()!=e.getEl()&&$(this).remove()});var r=e.getNote().$el,i=r.children(".page-buttons"),s=e.getNote().model.get("style").bgColor,o="rgb("+s[0]+","+s[1]+","+s[2]+")",u=this.calculateContrastingColor(o);if(i.length===0){i=$(this.template());r.append(i)}i.css("background-color",o).css("border-top","1px solid "+u).children("a").css("color",u);i.show();n&&this.showButtons();i.on("mousedown mouseup mousemove touchstart touchend touchmove",function(e){e.stopPropagation()})},toggleButtons:function(){this.buttonsAreVisible()?this.hideButtons():this.showButtons()},showButtons:function(){$(".page-buttons").show();$(".page-buttons").css("box-shadow","rgba(0, 0, 0, 0.3) 0 0 3px");$(".page-buttons").css("bottom","0px");this.isVisible=!0},hideButtons:function(){if(this.isVisible){$(".page-buttons").css("box-shadow","");$(".page-buttons").css("bottom","-60px")}this.isVisible=!1},buttonsAreVisible:function(){return $(".page-buttons").css("bottom")=="0px"},calculateContrastingColor:function(e){var t=_.map(e.slice(4,-1).split(","),function(e){return Number(e)}),n=_.reduce(t,function(e,t){return e+t},0)/3<128,r=n?255:0,i=_.map(t,function(e){return Math.round((e+3*r)/4)});return"rgb("+i[0]+","+i[1]+","+i[2]+")"}});return t});